#!/bin/bash

echo "[RVM]"

if [ ! `command -v "rvm"` ]; then
    # If RVM's not installed, install it and the rubies
    echo "\n* Installing RVM"

    # https://rvm.io
    curl -L https://get.rvm.io | bash -s stable --ruby

    echo "\n* Install rubies"

    # Install rubies and update rubygems
    rvm install 1.9.3
    rvm install 1.8.7-p371

    # But ultimately, the system should be the default
    rvm --default use system

    # A few prerequisites
    sudo gem install bluecloth capistrano bundler
else
    # Otherwise, update it

    # Make sure rvm is sourced properly
    if [ -f ~/.rvm/scripts/rvm ]; then
        [[ "$(type rvm)" =~ "function$" ]] || source ~/.rvm/scripts/rvm
    fi

    # Update all rubies and rubygems
    for v in 1.9.3 1.8.7; do
        echo "\n* Updating ruby $v"
        rvm use $v
        gem update --system
        gem update
    done

    # Update system ruby
    echo "\n* Updating system ruby"
    rvm use system
    sudo gem update --system
    sudo gem update
fi

echo "\nDone!"
