#!/usr/bin/env zsh
#
# Present a Rofi menu to power down, reboot, reboot into a specific systemd-boot
# target, sleep, or logout.

_rofi() { rofi -theme powermenu "$@"; }


### Options ###
all=(shutdown reboot rebootinto suspend logout)

declare -A icons
icons[shutdown]=""
icons[reboot]=""
icons[rebootinto]=""
icons[suspend]="鈴"
icons[logout]=""

declare -A labels
labels[shutdown]="Shutdown"
labels[reboot]="Reboot"
labels[rebootinto]="Reboot into..."
labels[suspend]="Sleep"
labels[logout]="Logout"

# Variable passed to rofi
choice=$(for k in "${all[@]}"; do echo "${icons[$k]}\t$labels[$k]"; done | _rofi -dmenu -i -selected-row 2)
choice="${choice#*	}"

echo "Choice: $choice"
case $choice in
    "${labels[shutdown]}") systemctl poweroff ;;
    "${labels[reboot]}") systemctl reboot ;;
    "${labels[rebootinto]}")
        entry=$(systemctl reboot --boot-loader-entry=help | _rofi -dmenu -i -p "Reboot into...")
        [[ -n "$entry" ]] && systemctl reboot --boot-loader-entry="$entry"
        ;;
    "${labels[suspend]}")
        playerctl -a pause
        systemctl suspend
        ;;
    "${labels[logout]}") bspc quit ;;
esac
